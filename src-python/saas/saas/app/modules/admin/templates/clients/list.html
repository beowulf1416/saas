{% extends "saas.app.modules.admin:templates/default.html" %}

{% block title %}
Administer Clients
{% endblock title %}

{% block content %}
<h1>Administer Clients</h1>
<div class="notifications-wrapper">
    <notification-list></notification-list>
</div><!-- .notifications-wrapper -->
<div class="clients-wrapper">
    <clients-table show-add></clients-table>
</div><!-- .clients-wrapper -->
{% endblock content %}

{% block scripts %}
<script type="module" src="/static/js/components/notification.list.js"></script>
<script type="module" src="/static/js/components/clients/clients.table.js"></script>
<script type="module" src="/static/js/helpers/clients.js"></script>
<script type="module">
'use strict';
import { Clients } from '/static/js/helpers/clients.js';
(function(){
    const notifier = document.querySelector('notification-list');
    const ctbl = document.querySelector('clients-table');
    const refreshClients = function() {
        Clients.getAll().then((d) => {
            if (d.status == 'success') {
                ctbl.setClients(d.json.clients);
            } else {
                notifier.add('error', d.message);
            }
        });
    };
    refreshClients();

    ctbl.addEventListener('onaddclient', function(e) {
        window.location = '/admin/clients/add';
    });

    ctbl.addEventListener('onselectclient', function(e) {
        const client_id = e.detail.clientId;
        Clients.get(client_id).then((r) => {
            if (r.status == 'success') {
                const url_name = r.json.client.url_name;
                window.location = `{{ request.route_path('admin.clients') }}/${url_name}`;
            } else {
                notifier.add('error', r.message);
            }
        });
    });

    ctbl.addEventListener('onupdateclientactive', function(e) {
        const clientId = e.detail.clientId;
        const active = e.detail.active == 'true' ? false : true;
        Clients.setActive(clientId, active).then((r) => {
            if (r.status == 'success') {
                refreshClients();     
            } else {
                notifier.add('error', r.message);
            }
        });
    });
})();
</script>
{% endblock %}